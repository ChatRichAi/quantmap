<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QuantClaw Evolution Ecosystem - ÁîüÊÄÅÂèØËßÜÂåñ</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            overflow: hidden;
        }
        
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 20px 40px;
            background: rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 24px;
            font-weight: 300;
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .stats-bar {
            display: flex;
            gap: 30px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: 600;
            color: #e94560;
        }
        
        .stat-label {
            font-size: 11px;
            color: #8892b0;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        #ecosystem-viz {
            width: 100vw;
            height: 100vh;
        }
        
        .node {
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .node:hover {
            filter: brightness(1.3);
        }
        
        .node-circle {
            stroke: rgba(255,255,255,0.3);
            stroke-width: 2;
        }
        
        .link {
            stroke-opacity: 0.4;
            transition: all 0.3s ease;
        }
        
        .link:hover {
            stroke-opacity: 0.8;
            stroke-width: 3;
        }
        
        .node-label {
            font-size: 11px;
            fill: #ccd6f6;
            text-anchor: middle;
            pointer-events: none;
            font-weight: 500;
        }
        
        .node-sublabel {
            font-size: 9px;
            fill: #8892b0;
            text-anchor: middle;
            pointer-events: none;
        }
        
        .tooltip {
            position: absolute;
            padding: 15px 20px;
            background: rgba(10, 25, 47, 0.95);
            border: 1px solid #e94560;
            border-radius: 8px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            max-width: 300px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        
        .tooltip h3 {
            color: #e94560;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .tooltip p {
            color: #8892b0;
            font-size: 12px;
            line-height: 1.5;
            margin: 5px 0;
        }
        
        .legend {
            position: fixed;
            bottom: 30px;
            left: 30px;
            background: rgba(0,0,0,0.5);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .legend h4 {
            font-size: 12px;
            color: #8892b0;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 8px 0;
            font-size: 12px;
            color: #ccd6f6;
        }
        
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 10px;
        }
        
        .btn {
            padding: 12px 24px;
            background: rgba(233, 69, 96, 0.2);
            border: 1px solid #e94560;
            color: #e94560;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn:hover {
            background: #e94560;
            color: #fff;
        }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .glow {
            filter: drop-shadow(0 0 10px currentColor);
        }
        
        .layer-label {
            position: absolute;
            font-size: 10px;
            color: rgba(136, 146, 176, 0.5);
            text-transform: uppercase;
            letter-spacing: 2px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üß¨ QuantClaw Evolution Ecosystem</h1>
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="stat-nodes">0</div>
                <div class="stat-label">Entities</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="stat-links">0</div>
                <div class="stat-label">Relations</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="stat-strategies">0</div>
                <div class="stat-label">Strategies</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="stat-transactions">0</div>
                <div class="stat-label">Transactions</div>
            </div>
        </div>
    </div>

    <svg id="ecosystem-viz"></svg>
    
    <div class="tooltip" id="tooltip"></div>
    
    <div class="legend">
        <h4>Entity Types</h4>
        <div class="legend-item">
            <div class="legend-dot" style="background: #e94560;"></div>
            <span>Strategy (Á≠ñÁï•)</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background: #0ea5e9;"></div>
            <span>Factor/Gene (Âõ†Â≠ê)</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background: #10b981;"></div>
            <span>Paper (ËÆ∫Êñá)</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background: #f59e0b;"></div>
            <span>Agent (ËäÇÁÇπ)</span>
        </div>
        <div class="legend-item">
            <div class="legend-dot" style="background: #8b5cf6;"></div>
            <span>Asset (ËµÑ‰∫ß)</span>
        </div>
    </div>
    
    <div class="controls">
        <button class="btn" onclick="resetZoom()">Reset View</button>
        <button class="btn" onclick="toggleAnimation()">Pause/Resume</button>
        <button class="btn" onclick="addRandomNode()">+ Add Node</button>
    </div>

    <script>
        // ÁîüÊÄÅÁ≥ªÁªüÊï∞ÊçÆ
        const ecosystemData = {
            nodes: [
                // ‰∏≠ÂøÉÁ≠ñÁï•
                { id: "strategy_001", name: "EntropyMomentum Pro", type: "strategy", sharpe: 1.8, radius: 25 },
                { id: "strategy_002", name: "RSI Mean Reversion", type: "strategy", sharpe: 1.5, radius: 20 },
                { id: "strategy_003", name: "Trend Following", type: "strategy", sharpe: 1.3, radius: 20 },
                { id: "strategy_004", name: "Volatility Arb", type: "strategy", sharpe: 1.6, radius: 22 },
                
                // Âõ†Â≠ê
                { id: "factor_001", name: "Sample Entropy", type: "factor", category: "complexity", radius: 15 },
                { id: "factor_002", name: "Hurst Exponent", type: "factor", category: "trend", radius: 15 },
                { id: "factor_003", name: "RSI(14)", type: "factor", category: "momentum", radius: 12 },
                { id: "factor_004", name: "Bollinger Bands", type: "factor", category: "volatility", radius: 14 },
                { id: "factor_005", name: "MACD", type: "factor", category: "trend", radius: 13 },
                { id: "factor_006", name: "Permutation Entropy", type: "factor", category: "complexity", radius: 15 },
                
                // ËÆ∫Êñá
                { id: "paper_001", name: "Entropy Regularization", type: "paper", arxiv: "1234.5678", radius: 18 },
                { id: "paper_002", name: "Mean Reversion Patterns", type: "paper", arxiv: "2345.6789", radius: 16 },
                { id: "paper_003", name: "Trend Following Analysis", type: "paper", arxiv: "3456.7890", radius: 16 },
                
                // AgentËäÇÁÇπ
                { id: "agent_001", name: "Alpha Node", type: "agent", reputation: 85, radius: 20 },
                { id: "agent_002", name: "Beta Node", type: "agent", reputation: 72, radius: 18 },
                { id: "agent_003", name: "Gamma Node", type: "agent", reputation: 68, radius: 18 },
                { id: "agent_004", name: "Delta Node", type: "agent", reputation: 91, radius: 22 },
                
                // ËµÑ‰∫ß
                { id: "asset_001", name: "AAPL", type: "asset", sector: "tech", radius: 12 },
                { id: "asset_002", name: "MSFT", type: "asset", sector: "tech", radius: 12 },
                { id: "asset_003", name: "BTC", type: "asset", sector: "crypto", radius: 14 },
                { id: "asset_004", name: "ETH", type: "asset", sector: "crypto", radius: 13 },
                { id: "asset_005", name: "GLD", type: "asset", sector: "commodity", radius: 11 },
            ],
            links: [
                // Á≠ñÁï•-Âõ†Â≠êÂÖ≥Á≥ª
                { source: "strategy_001", target: "factor_001", type: "uses" },
                { source: "strategy_001", target: "factor_002", type: "uses" },
                { source: "strategy_001", target: "factor_006", type: "uses" },
                { source: "strategy_002", target: "factor_003", type: "uses" },
                { source: "strategy_002", target: "factor_004", type: "uses" },
                { source: "strategy_003", target: "factor_002", type: "uses" },
                { source: "strategy_003", target: "factor_005", type: "uses" },
                { source: "strategy_004", target: "factor_004", type: "uses" },
                { source: "strategy_004", target: "factor_006", type: "uses" },
                
                // Á≠ñÁï•-ËÆ∫ÊñáÂÖ≥Á≥ª
                { source: "strategy_001", target: "paper_001", type: "implements" },
                { source: "strategy_002", target: "paper_002", type: "implements" },
                { source: "strategy_003", target: "paper_003", type: "implements" },
                
                // Agent-Á≠ñÁï•ÂÖ≥Á≥ª
                { source: "agent_001", target: "strategy_001", type: "created" },
                { source: "agent_002", target: "strategy_002", type: "created" },
                { source: "agent_003", target: "strategy_003", type: "created" },
                { source: "agent_004", target: "strategy_004", type: "created" },
                { source: "agent_004", target: "strategy_001", type: "improved" },
                
                // Á≠ñÁï•-ËµÑ‰∫ßÂÖ≥Á≥ª
                { source: "strategy_001", target: "asset_001", type: "trades" },
                { source: "strategy_001", target: "asset_002", type: "trades" },
                { source: "strategy_002", target: "asset_003", type: "trades" },
                { source: "strategy_003", target: "asset_004", type: "trades" },
                { source: "strategy_004", target: "asset_005", type: "trades" },
                
                // Âõ†Â≠ê-ËÆ∫ÊñáÂÖ≥Á≥ª
                { source: "factor_001", target: "paper_001", type: "based_on" },
                { source: "factor_006", target: "paper_001", type: "based_on" },
            ]
        };

        // È¢úËâ≤ÈÖçÁΩÆ
        const colors = {
            strategy: "#e94560",
            factor: "#0ea5e9",
            paper: "#10b981",
            agent: "#f59e0b",
            asset: "#8b5cf6"
        };

        // ÈìæÊé•È¢úËâ≤
        const linkColors = {
            uses: "#0ea5e9",
            implements: "#10b981",
            created: "#f59e0b",
            improved: "#e94560",
            trades: "#8b5cf6",
            based_on: "#64748b"
        };

        // ÂàùÂßãÂåñSVG
        const width = window.innerWidth;
        const height = window.innerHeight;
        
        const svg = d3.select("#ecosystem-viz")
            .attr("width", width)
            .attr("height", height);

        // Ê∑ªÂä†Áº©ÊîæË°å‰∏∫
        const g = svg.append("g");
        
        const zoom = d3.zoom()
            .scaleExtent([0.1, 4])
            .on("zoom", (event) => {
                g.attr("transform", event.transform);
            });
        
        svg.call(zoom);

        // ÂàõÂª∫ÂäõÂØºÂêëÊ®°Êãü
        const simulation = d3.forceSimulation(ecosystemData.nodes)
            .force("link", d3.forceLink(ecosystemData.links).id(d => d.id).distance(100))
            .force("charge", d3.forceManyBody().strength(-300))
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("collision", d3.forceCollide().radius(d => d.radius + 10));

        // ÁªòÂà∂ÈìæÊé•
        const link = g.append("g")
            .selectAll("line")
            .data(ecosystemData.links)
            .enter().append("line")
            .attr("class", "link")
            .attr("stroke", d => linkColors[d.type] || "#64748b")
            .attr("stroke-width", 1.5);

        // ÁªòÂà∂ËäÇÁÇπÁªÑ
        const node = g.append("g")
            .selectAll("g")
            .data(ecosystemData.nodes)
            .enter().append("g")
            .attr("class", "node")
            .call(d3.drag()
                .on("start", dragstarted)
                .on("drag", dragged)
                .on("end", dragended));

        // ËäÇÁÇπÂúÜÂΩ¢
        node.append("circle")
            .attr("class", "node-circle")
            .attr("r", d => d.radius)
            .attr("fill", d => colors[d.type])
            .attr("opacity", 0.8);

        // ËäÇÁÇπÂÜÖÂèëÂÖâÊïàÊûú
        node.append("circle")
            .attr("r", d => d.radius * 0.6)
            .attr("fill", d => colors[d.type])
            .attr("opacity", 0.4)
            .attr("class", "glow");

        // ËäÇÁÇπÊ†áÁ≠æ
        node.append("text")
            .attr("class", "node-label")
            .attr("dy", d => d.radius + 15)
            .text(d => d.name);

        // ËäÇÁÇπÂ≠êÊ†áÁ≠æ
        node.append("text")
            .attr("class", "node-sublabel")
            .attr("dy", d => d.radius + 28)
            .text(d => {
                if (d.type === "strategy") return `Sharpe: ${d.sharpe}`;
                if (d.type === "agent") return `Rep: ${d.reputation}`;
                if (d.type === "paper") return d.arxiv;
                return d.category || d.sector || "";
            });

        // Tooltip
        const tooltip = d3.select("#tooltip");

        node.on("mouseover", (event, d) => {
            let content = `<h3>${d.name}</h3>`;
            content += `<p>Type: ${d.type}</p>`;
            
            if (d.type === "strategy") {
                content += `<p>Sharpe Ratio: ${d.sharpe}</p>`;
                content += `<p>Click to view lineage</p>`;
            } else if (d.type === "agent") {
                content += `<p>Reputation: ${d.reputation}/100</p>`;
                content += `<p>Node ID: ${d.id}</p>`;
            } else if (d.type === "paper") {
                content += `<p>arXiv: ${d.arxiv}</p>`;
            }
            
            tooltip.html(content)
                .style("opacity", 1)
                .style("left", (event.pageX + 10) + "px")
                .style("top", (event.pageY - 10) + "px");
        })
        .on("mouseout", () => {
            tooltip.style("opacity", 0);
        })
        .on("click", (event, d) => {
            highlightConnections(d);
        });

        // Êõ¥Êñ∞‰ΩçÁΩÆ
        simulation.on("tick", () => {
            link
                .attr("x1", d => d.source.x)
                .attr("y1", d => d.source.y)
                .attr("x2", d => d.target.x)
                .attr("y2", d => d.target.y);

            node.attr("transform", d => `translate(${d.x},${d.y})`);
        });

        // ÊãñÊãΩÂáΩÊï∞
        function dragstarted(event, d) {
            if (!event.active) simulation.alphaTarget(0.3).restart();
            d.fx = d.x;
            d.fy = d.y;
        }

        function dragged(event, d) {
            d.fx = event.x;
            d.fy = event.y;
        }

        function dragended(event, d) {
            if (!event.active) simulation.alphaTarget(0);
            d.fx = null;
            d.fy = null;
        }

        // È´ò‰∫ÆËøûÊé•
        function highlightConnections(d) {
            // ÈáçÁΩÆÊâÄÊúâ
            link.attr("stroke-opacity", 0.2);
            node.attr("opacity", 0.3);
            
            // È´ò‰∫ÆÁõ∏ÂÖ≥ËøûÊé•
            const connectedLinks = ecosystemData.links.filter(l => 
                l.source.id === d.id || l.target.id === d.id
            );
            
            link.filter(l => connectedLinks.includes(l))
                .attr("stroke-opacity", 1)
                .attr("stroke-width", 3);
            
            // È´ò‰∫ÆÁõ∏ÂÖ≥ËäÇÁÇπ
            const connectedNodeIds = new Set();
            connectedNodeIds.add(d.id);
            connectedLinks.forEach(l => {
                connectedNodeIds.add(l.source.id);
                connectedNodeIds.add(l.target.id);
            });
            
            node.filter(n => connectedNodeIds.has(n.id))
                .attr("opacity", 1);
            
            // 3ÁßíÂêéÊÅ¢Â§ç
            setTimeout(() => {
                link.attr("stroke-opacity", 0.4).attr("stroke-width", 1.5);
                node.attr("opacity", 1);
            }, 3000);
        }

        // Êõ¥Êñ∞ÁªüËÆ°
        function updateStats() {
            document.getElementById("stat-nodes").textContent = ecosystemData.nodes.length;
            document.getElementById("stat-links").textContent = ecosystemData.links.length;
            document.getElementById("stat-strategies").textContent = 
                ecosystemData.nodes.filter(n => n.type === "strategy").length;
            document.getElementById("stat-transactions").textContent = 
                Math.floor(Math.random() * 100) + 50; // Ê®°Êãü‰∫§ÊòìÊï∞
        }

        updateStats();

        // ÊéßÂà∂ÂáΩÊï∞
        let isAnimating = true;
        
        function resetZoom() {
            svg.transition().duration(750).call(
                zoom.transform,
                d3.zoomIdentity
            );
        }

        function toggleAnimation() {
            if (isAnimating) {
                simulation.stop();
            } else {
                simulation.restart();
            }
            isAnimating = !isAnimating;
        }

        function addRandomNode() {
            const types = ["strategy", "factor", "paper", "agent"];
            const type = types[Math.floor(Math.random() * types.length)];
            const id = `node_${Date.now()}`;
            
            const newNode = {
                id: id,
                name: `New ${type}`,
                type: type,
                radius: 15
            };
            
            if (type === "strategy") {
                newNode.sharpe = (Math.random() * 2 + 0.5).toFixed(2);
            } else if (type === "agent") {
                newNode.reputation = Math.floor(Math.random() * 40 + 60);
            }
            
            ecosystemData.nodes.push(newNode);
            
            // ËøûÊé•Âà∞ÈöèÊú∫Áé∞ÊúâËäÇÁÇπ
            const targetNode = ecosystemData.nodes[Math.floor(Math.random() * (ecosystemData.nodes.length - 1))];
            ecosystemData.links.push({
                source: newNode,
                target: targetNode,
                type: "uses"
            });
            
            // ÈáçÊñ∞ÂêØÂä®Ê®°Êãü
            simulation.nodes(ecosystemData.nodes);
            simulation.force("link").links(ecosystemData.links);
            simulation.alpha(1).restart();
            
            updateStats();
        }

        // Á™óÂè£Â§ßÂ∞èË∞ÉÊï¥
        window.addEventListener("resize", () => {
            const w = window.innerWidth;
            const h = window.innerHeight;
            svg.attr("width", w).attr("height", h);
            simulation.force("center", d3.forceCenter(w / 2, h / 2));
            simulation.alpha(0.3).restart();
        });

        // Ê®°ÊãüÂÆûÊó∂Êï∞ÊçÆÊõ¥Êñ∞
        setInterval(() => {
            // ÈöèÊú∫Ê∑ªÂä†ÂæÆÂº±Âäõ‰ª•‰∫ßÁîü"ÂëºÂê∏"ÊïàÊûú
            ecosystemData.nodes.forEach(node => {
                node.vx += (Math.random() - 0.5) * 0.5;
                node.vy += (Math.random() - 0.5) * 0.5;
            });
            simulation.alpha(0.1);
        }, 3000);

        console.log("üß¨ QuantClaw Evolution Ecosystem Visualization loaded!");
        console.log(`Nodes: ${ecosystemData.nodes.length}, Links: ${ecosystemData.links.length}`);
    </script>
</body>
</html>
